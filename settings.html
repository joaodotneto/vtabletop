<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <link rel="stylesheet" href="css/bootstrap.min.css?1" />
    <link rel="stylesheet" href="css/common.css?1" />
    <script type="text/javascript" src="js/jquery.min.js?1"></script>
    <script type="text/javascript" src="js/bootstrap.min.js?1"></script>
    <script type="text/javascript" src="js/common.js?2"></script>
    <script type="text/javascript" src="js/classes.js?1"></script>
    <title></title>
    <script type="text/javascript">
        $(document).ready(() => {
            $("input[type=number]").blur(function () {
                var self = $(this);
                val = parseFloat(self.val());
                min = parseFloat(self.attr("min"));
                max = parseFloat(self.attr("max"));
                if (val > max) {
                    self.val(max);
                } else if (val < min) {
                    self.val(min);
                }
                try {
                    eval(self.attr("lazyblur"));
                } catch (e) {
                    console.log(e);
                }
            });
            CreateToggles();
        });

        function GetSettingsData() {
            return {
                Box: getInt("numBox"),
                X: getInt("numCompX"),
                Y: getInt("numCompY"),
                Z: getFloat("numCompZ"),
                R: chkVal("chkHorizontal"),
                G: chkVal("chkShowGrid"),
                Coords: chkVal("chkShowCoords"),
                PX: 0,
                PY: 0,
                Color: $("#numColor").val(),
                BackColor: $("#numColorBk").val(),
                //Layers: JSON.stringify(parsedLayers),
                RevealColor: $("#numColorMapReveal").val(),
                //Reveals: JSON.stringify(currentRevealList),
                Parallax: {
                    Anim: chkVal("chkParallaxAnim"),
                    Dir: chkVal("chkParallaxRtl"),
                    Ver: chkVal("chkParallaxVertical"),
                    Spd: getFloat("numkParallaxSpeed", 1.0),
                    X: getInt("numParallaxX"),
                    Y: getInt("numParallaxY"),
                    Opacity: getFloat("numParallaxOp")
                }
            };
        }

        function SendToParent(command, attributes) {
            var objSend = {
                cmd: command,
                attrs: attributes,
                parameters: GetSettingsData()
            };
            window.opener.postMessage(objSend);
        }

        function ResetCanvas() {
            SendToParent("ResetCanvas", null);
        }

        function LoadBackground() {
            LoadImage((file) => {
                var objSend = {
                    cmd: "LoadBackground",
                    file: file
                };
                window.opener.postMessage(objSend);
            });
        }

        function LoadParallax() {
            LoadImage((file) => {
                var objSend = {
                    cmd: "LoadParallax",
                    file: file
                };
                window.opener.postMessage(objSend);
            });
        }

        function ResetAdjusts() {
            parent.ResetAdjusts();
        }

        function SetBoxValue(value) {
            parent.SetBoxValue(value);
        }

        function SetCanvasZoom() {
            //TODO: Propagar valores dos controles
            parent.SetCanvasZoom();
        }
    </script>
</head>
<body>
    <div>
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Settings</a></li>
            <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Layers</a></li>
            <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Map Reveals</a></li>
            <li role="presentation"><a href="#settings" aria-controls="settings" role="tab" data-toggle="tab">Animations</a></li>
        </ul>
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="home" style="padding: 8px">
                <table style="width: 100%;">
                    <tr>
                        <td style="width: 50%">
                            <div class="input-group input-group-sm" title="Global Show" style="margin-bottom: 3px">
                                <span class="input-group-addon addon-74p" style="font-weight: bold">Fog:</span>
                                <div class="form-control input-sm">
                                    <input type="range" min="0" max="1" step="0.1" id="numGlobalShow" value="0" oninput="ResetCanvas()" />
                                </div>
                            </div>
                        </td>
                        <td style="width: 8px">&nbsp;</td>
                        <td>
                            <div id="divShowGrid"></div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="input-group input-group-sm" style="margin-bottom: 3px">
                                <div class="input-group-btn">
                                    <a class="btn btn-default" onclick="LoadBackground()" title="Background">
                                        <i class="glyphicon glyphicon-picture"></i>&nbsp;Background
                                    </a>
                                    <a class="btn btn-default" onclick="LoadParallax()" title="Parallax">
                                        <i class="glyphicon glyphicon-picture"></i>&nbsp;Parallax
                                    </a>
                                </div>
                            </div>
                        </td>
                        <td></td>
                        <td>
                            <div id="divHorizontal"></div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="input-group input-group-sm" style="margin-bottom: 5px">
                                <div class="input-group-btn">
                                    <a class="btn btn-default" style="width: 100%" onclick="ResetAdjusts()" title="Reset">
                                        <i class="glyphicon glyphicon-refresh"></i>&nbsp;Reset Settings
                                    </a>
                                </div>
                            </div>
                        </td>
                        <td></td>
                        <td>
                            <div id="divShowCoords"></div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="input-group input-group-sm" title="Background Color">
                                <span class="input-group-addon addon-60p" style="font-weight: bold">BC:</span>
                                <input type="color" class="form-control input-sm" id="numColorBk" value="#000000" oninput="ResetCanvas()" />
                            </div>
                        </td>
                        <td></td>
                        <td>
                            <div class="input-group input-group-sm" title="Grid Color">
                                <span class="input-group-addon addon-60p" style="font-weight: bold">GC:</span>
                                <input type="color" class="form-control input-sm" id="numColor" value="#ff0000" oninput="ResetCanvas()" />
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="input-group input-group-sm">
                                <span class="input-group-addon addon-60p" style="font-weight: bold">Box:</span>
                                <input type="number" class="form-control input-sm" min="48" max="128" step="1" id="numBox" value="96" lazyblur="ResetCanvas()" />
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span></button>
                                    <ul class="dropdown-menu" style="min-width: 50px !important;">
                                        <li><a onclick="SetBoxValue('48')">48</a></li>
                                        <li><a onclick="SetBoxValue('72')">72</a></li>
                                        <li><a onclick="SetBoxValue('96')">96</a></li>
                                    </ul>
                                </div>
                            </div>
                        </td>
                        <td></td>
                        <td>
                            <div class="input-group input-group-sm">
                                <span class="input-group-addon addon-60p" style="font-weight: bold">Zoom:</span>
                                <input type="number" class="form-control input-sm" min="-5" max="5" step=".01" id="numCompZ" value="1" onchange="SetCanvasZoom()" pattern="^\d*(\.\d{0,2})?$" />
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="input-group input-group-sm" title="Background Complement X">
                                <span class="input-group-addon addon-60p" style="font-weight: bold">CX:</span>
                                <input type="number" class="form-control input-sm" min="-100" max="100" id="numCompX" value="0" lazyblur="ResetCanvas()" />
                            </div>
                        </td>
                        <td></td>
                        <td>
                            <div class="input-group input-group-sm" title="Background Complement Y">
                                <span class="input-group-addon addon-60p" style="font-weight: bold">CY:</span>
                                <input type="number" class="form-control input-sm" min="-100" max="100" id="numCompY" value="0" lazyblur="ResetCanvas()" />
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <div style="margin-top: 8px"></div>
                            <label class="lbl-header">Parallax Settings</label>
                        </td>
                    </tr>
                    <tr>
                        <td><div id="divParallaxAnim"></div></td>
                        <td></td>
                        <td><div id="divParallaxRtl"></div></td>
                    </tr>
                    <tr>
                        <td><div id="divParallaxVertical"></div></td>
                        <td></td>
                        <td><div id="divParallaxStretch"></div></td>
                    </tr>
                    <tr>
                        <td>
                            <div class="input-group input-group-sm">
                                <span class="input-group-addon addon-60p" style="font-weight: bold">Speed:</span>
                                <input type="number" class="form-control input-sm" min="-5" max="5" step=".01" id="numkParallaxSpeed" value="2" onchange="ResetCanvas()" />
                            </div>
                        </td>
                        <td></td>
                        <td>
                            <div class="input-group input-group-sm" title="Parallax Complement X">
                                <span class="input-group-addon addon-60p" style="font-weight: bold">CX:</span>
                                <input type="number" class="form-control input-sm" min="-100" max="100" id="numParallaxX" value="0" lazyblur="ResetCanvas()" />
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="input-group input-group-sm" title="Parallax Complement Y">
                                <span class="input-group-addon addon-60p" style="font-weight: bold">CY:</span>
                                <input type="number" class="form-control input-sm" min="-100" max="100" id="numParallaxY" value="0" lazyblur="ResetCanvas()" />
                            </div>
                        </td>
                        <td></td>
                        <td>
                            <div class="input-group input-group-sm">
                                <span class="input-group-addon addon-74p" style="font-weight: bold">Opacity:</span>
                                <div class="form-control input-sm">
                                    <input type="range" min="0" max="1" step="0.1" id="numParallaxOp" value="1" oninput="ResetCanvas()" />
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div role="tabpanel" class="tab-pane" id="profile">...</div>
            <div role="tabpanel" class="tab-pane" id="messages">...</div>
            <div role="tabpanel" class="tab-pane" id="settings">...</div>
        </div>
    </div>
</body>
</html>