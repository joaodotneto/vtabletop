<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <link rel="stylesheet" href="css/bootstrap.min.css?1" />
    <link rel="stylesheet" href="css/common.css?5" />
    <script type="text/javascript" src="js/jquery.min.js?1"></script>
    <script type="text/javascript" src="js/bootstrap.min.js?1"></script>
    <script type="text/javascript" src="js/common.js?4"></script>
    <script type="text/javascript" src="js/classes.js"></script>
    <script type="text/javascript">
        var currentImg = new Image();
        var currentAnimation = null;

        $(document).ready(() => {
            ConfigureCanvas();
            ResetCanvas();
        });

        function ConfigureCanvas() {
            canvasObj = document.getElementById("baseCanvas");
            canvasCtx = canvasObj.getContext("2d");
            canvasCtx.canvas.width = canvasObj.width = 288;
            canvasCtx.canvas.height = canvasObj.height = 288;
        }

        function ResetCanvas() {
            requestAnimationFrame(ResetCanvas);
            var backcolor = $("#numColor").val();
            canvasCtx.save();
            canvasCtx.fillStyle = backcolor;
            canvasCtx.fillRect(0, 0, canvasObj.width, canvasObj.height);
            canvasCtx.restore();
            var now = Date.now();
            var deltaSeconds = (now - lastFrameTime) / 1000;
            lastFrameTime = now;
            if (currentAnimation) {
                currentAnimation.draw(canvasCtx, deltaSeconds);
            }
        }

        function SelectImage() {
            LoadImage((file) => {
                currentAnimation = new ImageAnimation();
                currentAnimation.initialize(URL.createObjectURL(file), (img) => {
                    currentAnimation.frameStep = 2;
                    currentAnimation.frameWidth = img.width / 2;
                    currentAnimation.frameHeight = img.height;
                });
            });
        }

        function UpdateAnimation() {
            if (currentAnimation) {
                var step = getInt("numAnimW");
                currentAnimation.frameStep = step;
                currentAnimation.frameWidth = currentAnimation.img.width / step;
                currentAnimation.frameSpeed = getFloat("numAnimH", 0.5);
                currentAnimation.flipType = getInt("lstFlipAnim");
                currentAnimation.transp = getFloat("numAnimOp", 1.0);
            }
        }
    </script>
    <title></title>
</head>
<body>
    <div style="display: none">
        <input type="file" id="uploadFile" accept="image/*" />
        <input type="file" id="uploadSettings" accept=".json" />
        <canvas id="saveCanvas"></canvas>
    </div>
    <div style="margin: 10px 0 0 10px;">
        <table style="width: 650px;">
            <tr>
                <td colspan="5"><label class="lbl-header">Animation</label></td>
            </tr>
            <tr>
                <td style="width: 250px; position: relative">
                    <canvas id="baseCanvas" style="width: 288px; height: 288px; border: 1px solid #000000; "></canvas>
                    <div style="position: absolute; top: 1px; right: 1px; width: 50px;">
                        <input type="color" class="form-control input-sm" id="numColor" value="#ffffff" />
                    </div>
                </td>
                <td style="width: 8px">&nbsp;</td>
                <td style="vertical-align: top">
                    <div class="input-group input-group-sm" style="margin-bottom: 10px">
                        <div class="input-group-btn">
                            <a class="btn btn-default" onclick="SelectImage()" title="Select File">
                                <i class="glyphicon glyphicon-picture"></i>&nbsp;Select
                            </a>
                        </div>
                        <div class="form-control input-sm" style="background-color: #eee"></div>
                    </div>
                    <table style="width: 100%">
                        <tr>
                            <td colspan="3">
                                <div class="input-group input-group-sm">
                                    <span class="input-group-addon addon-74p" style="font-weight: bold">Name:</span>
                                    <input type="text" class="form-control input-sm" id="txtAnimName" onblur="UpdateAnimation()" />
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td style="width: 160px">
                                <div class="input-group input-group-sm">
                                    <span class="input-group-addon addon-74p" style="font-weight: bold">Frames:</span>
                                    <input type="number" class="form-control input-sm" min="0" step="1" id="numAnimW" value="2" onchange="UpdateAnimation()" onblur="UpdateAnimation()" />
                                </div>
                            </td>
                            <td style="width: 8px">&nbsp;</td>
                            <td>
                                <div class="input-group input-group-sm">
                                    <span class="input-group-addon addon-74p" style="font-weight: bold">Speed:</span>
                                    <input type="number" class="form-control input-sm" min="0.01" max="1" step=".01" id="numAnimH" value="0.5" onchange="UpdateAnimation()" onblur="UpdateAnimation()" />
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="input-group input-group-sm">
                                    <span class="input-group-addon addon-74p" style="font-weight: bold">Opacity:</span>
                                    <input type="number" class="form-control input-sm" min="0.01" max="1" step=".01" id="numAnimOp" value="1" onblur="UpdateAnimation()" pattern="^\d*(\.\d{0,2})?$" />
                                </div>
                            </td>
                            <td style="width: 8px">&nbsp;</td>
                            <td>
                                <div class="input-group input-group-sm">
                                    <span class="input-group-addon addon-74p" style="font-weight: bold">Flip:</span>
                                    <select class="form-control input-sm" id="lstFlipAnim" onchange="UpdateAnimation()">
                                        <option value="0">None</option>
                                        <option value="1">Horizontal</option>
                                        <option value="2">Vertical</option>
                                        <option value="3">Both</option>
                                    </select>
                                </div>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>
</body>
</html>